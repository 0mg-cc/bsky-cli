# CLI Sweep â€” 2026-02-11

Exhaustive command-by-command validation.

## Legend
- âœ… OK (nominal + error handling)
- âš ï¸ Issue found (minor, documented)
- ğŸ› Bug found and fixed

---

## Results

| Command | Status | Notes |
|---------|--------|-------|
| `--version` | âœ… | `bsky 1.6.0` |
| `config --path` | âœ… | |
| `notify --all` | âœ… | |
| `notify --json` | âœ… | |
| `notify --score` | âœ… | |
| `search` | âœ… | nominal, `--since`, `--sort`, `--compact` |
| `dms` | âœ… | `--limit`, `--preview`, `--json` |
| `dms show` | âœ… | |
| `people` | âœ… | `--regulars`, `--stats`, `--enrich` |
| `context` | ğŸ› | **Crash on invalid handle** (raw traceback). Fixed: try/except. |
| `context --json` | âœ… | |
| `search-history` | ğŸ› | **Crash on invalid handle** (same root cause). Fixed. |
| `threads list` | âœ… | |
| `threads evaluate` | âœ… | |
| `threads tree` | âœ… | |
| `threads branches` | âœ… | Handles invalid target gracefully |
| `threads backoff-check` | âœ… | Requires target arg |
| `threads migrate-state` | âœ… | |
| `bookmarks list` | âœ… | |
| `lists list` | âœ… | |
| `starterpack list` | âœ… | |
| `post --dry-run` | âœ… | text, `--quote`, `--embed`, length limit (301 â†’ error) |
| `reply --dry-run` | âœ… | |
| `like --dry-run` | âœ… | + error on invalid URL |
| `repost --dry-run` | âœ… | + error on invalid URL |
| `dm --dry-run` | âœ… | |
| `delete --dry-run` | âœ… | |
| `follow --dry-run` | âœ… | + error on nonexistent handle |
| `bookmark` | ğŸ› | **Broken API payload** (`{repo, subject}` â†’ `{uri, cid}`). Fixed. |
| `bookmark --remove` | âœ… | (after fix) |
| `engage --dry-run` | âœ… | Timeout at 30s = code 124, clean exit |
| `appreciate --dry-run` | âœ… | Timeout at 30s = code 124, clean exit |
| `discover follows --dry-run` | ğŸ› | **Hung past timeout** â€” `get_follows()` pagination unchecked. Fixed: guard passed into pagination loop. |
| `organic --dry-run` | âœ… | Probability gate + `--force` |
| `announce --dry-run` | âœ… | Error on missing slug |
| `profile` | âœ… | Requires at least one flag |

## Bugs Found & Fixed

### 1. `context` / `search-history` crash on invalid handle
- **Symptom**: Raw `requests.HTTPError` traceback
- **Fix**: Wrap `resolve_handle()` in try/except, print clean error
- **Files**: `context_cmd.py`, `search_history_cmd.py`

### 2. `bookmark` broken API payload
- **Symptom**: `400 Input must have the property "uri"` then `"cid"`
- **Fix**: New `resolve_post_uri_and_cid()` that fetches the post to get both URI and CID, used in create/delete bookmark
- **Files**: `bookmarks.py`, `tests/test_bookmarks.py`

### 3. `discover` hangs past `--max-runtime-seconds`
- **Symptom**: `get_follows()` paginates up to 200 pages without guard check â†’ can run for minutes past timeout
- **Fix**: Pass `guard` into `get_follows()`, check between pages, raise `DiscoverRuntimeTimeout` if expired
- **Files**: `discover.py`, `tests/test_discover.py`

### Minor Issues (not fixed, documented)
- `bookmarks list` shows `@unknown` for author â€” API may not embed full post data
- `dm --dry-run ""` accepts empty text â€” edge case, not a crash

## Test Suite
- **227/227 passed** after all fixes
